<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ§ AI èªéŸ³é€å­—ç¨¿åˆ†æ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
  />
  <style>
    body { background-color:#f9f9f9; padding-top:30px; }
    .container { max-width: 960px; }
    .section-title { font-weight:bold; margin-top:40px; margin-bottom:15px; font-size:1.25rem; }
    pre { background:#f4f4f4; padding:15px; border-radius:6px; max-height:400px; overflow-y:auto; }
  </style>
</head>
<body>
<div class="container">
  <h1 class="mb-4">ğŸ™ï¸ AI èªéŸ³è½‰æ–‡å­— & æ‘˜è¦ç³»çµ±</h1>

  {# Flash è¨Šæ¯ #}
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-info">
        {% for msg in messages %}
          <div>{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {# -------------------- Step 1ï¼šä¸Šå‚³ä¸¦åˆ‡å‰² -------------------- #}
  {% if (step|default(1)) == 1 %}
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title mb-3">Step 1ï½œä¸Šå‚³éŸ³æª”ä¸¦åˆ‡å‰²</h5>
        <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data">
          <div class="mb-3">
            <label for="file" class="form-label">ğŸ“‚ ä¸Šå‚³éŸ³æª”ï¼ˆ.mp3 / .wav / .m4aï¼‰</label>
            <input class="form-control" type="file" name="file" id="file" accept=".mp3,.wav,.m4a,audio/*" required>
            <div class="form-text">å¤§å°ä¸Šé™ç´„ 200MBï¼ˆè‹¥éœ€æ›´å¤§å¯èª¿æ•´è¨­å®šï¼‰ã€‚</div>
          </div>
          <button class="btn btn-primary" type="submit">â¬†ï¸ ä¸Šå‚³ä¸¦åˆ‡å‰²</button>
        </form>
      </div>
    </div>
  {% endif %}

  {# -------------------- Step 2ï¼šé¡¯ç¤ºåˆ†æ®µæ•¸ï¼Œè¼¸å…¥è¦åˆ†æçš„æ®µæ•¸ -------------------- #}
  {% if step == 2 %}
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title mb-2">Step 2ï½œè¨­å®šè¦åˆ†æçš„æ®µæ•¸</h5>
        <div class="alert alert-success mb-3">
          ğŸ§© é€™ä»½éŸ³æª”å·²åˆ†å‰²ç‚º <strong>{{ total_segments }}</strong> æ®µã€‚
        </div>
        <form action="{{ url_for('run') }}" method="post">
          <div class="mb-3">
            <label for="max_segments" class="form-label">ğŸ”¢ è¦åˆ†æçš„æ®µæ•¸ï¼ˆç•™ç©ºè¡¨ç¤ºå…¨éƒ¨ï¼‰</label>
            <input type="number" name="max_segments" id="max_segments" class="form-control"
                   placeholder="ä¾‹å¦‚ï¼š5" min="1" max="{{ total_segments }}">
            <div class="form-text">å»ºè­°å…ˆå°‘é‡æ¸¬è©¦ï¼ˆå¦‚ 3ï½5 æ®µï¼‰ï¼Œç¢ºèªå“è³ªå†è·‘å…¨éƒ¨ã€‚</div>
          </div>
          <button class="btn btn-primary" type="submit">ğŸš€ é–‹å§‹åˆ†æ</button>
          <a class="btn btn-outline-secondary ms-2" href="{{ url_for('index') }}">â†©ï¸ é‡æ–°ä¸Šå‚³</a>
        </form>
      </div>
    </div>
  {% endif %}

  {# -------------------- åˆ†æå®Œæˆï¼šä¸‹è¼‰èˆ‡æ–‡å­—è¼¸å‡º -------------------- #}
  {% if report_link %}
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">âœ… åˆ†æå®Œæˆ</h5>
        <a class="btn btn-success" href="{{ url_for('download', filename=report_link) }}">
          â¬‡ï¸ ä¸‹è¼‰ DOCX å ±å‘Šï¼š{{ report_link }}
        </a>
      </div>
    </div>
  {% endif %}

  {% if transcript_text %}
    <div class="section-title">ğŸ“„ åŸå§‹é€å­—ç¨¿ï¼ˆtranscript.txtï¼‰</div>
    <pre style="white-space: pre-wrap;">{{ transcript_text }}</pre>
  {% endif %}

  {% if review_text %}
    <div class="section-title">ğŸ“ å•é¡Œæ¸…å–®èˆ‡ä¿®æ­£å»ºè­°ï¼ˆtranscript_review.txtï¼‰</div>
    <pre style="white-space: pre-wrap;">{{ review_text }}</pre>
  {% endif %}

  {% if revised_text %}
    <div class="section-title">âœ… ä¿®æ­£ç‰ˆé€å­—ç¨¿ï¼ˆtranscript_revised.txtï¼‰</div>
    <pre style="white-space: pre-wrap;">{{ revised_text }}</pre>
  {% endif %}

</div>
</body>
</html>
